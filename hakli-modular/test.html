<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hakli Modules - Test Page</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            max-width: 900px;
            margin: 50px auto;
            padding: 20px;
            background: #1e1e1e;
            color: #d4d4d4;
        }
        .status {
            padding: 20px;
            margin: 10px 0;
            border-radius: 8px;
            border: 2px solid #333;
        }
        .pass { background: #1e3a1e; border-color: #4caf50; }
        .fail { background: #3a1e1e; border-color: #f44336; }
        .test-result { margin: 5px 0; padding: 5px; }
        .pass-mark { color: #4caf50; font-weight: bold; }
        .fail-mark { color: #f44336; font-weight: bold; }
        h1 { color: #61dafb; }
        button {
            background: #61dafb;
            color: #1e1e1e;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            margin: 10px 5px;
        }
        button:hover { background: #4fa8c5; }
        #output {
            background: #2d2d2d;
            padding: 15px;
            border-radius: 5px;
            margin-top: 20px;
            white-space: pre-wrap;
            font-family: 'Courier New', monospace;
            max-height: 400px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <h1>üì¶ Hakli Module Loader - Test Page</h1>
    
    <div id="results"></div>
    
    <button onclick="runTests()">üß™ Run All Tests</button>
    <button onclick="testIdGeneration()">üî¢ Test ID Generation</button>
    <button onclick="testStorage()">üíæ Test Storage</button>
    <button onclick="clearOutput()">üóëÔ∏è Clear Output</button>
    
    <div id="output"></div>

    <!-- Load modules in order -->
    <script src="./src/core/config.js"></script>
    <script src="./src/utils/helpers.js"></script>
    <script src="./src/storage/hki.js"></script>
    <script src="./src/storage/cache.js"></script>
    <script src="./src/storage/corrections.js"></script>
    <script src="./src/storage/export.js"></script>
    <script src="./src/recognition/isolation.js"></script>
    <script src="./src/recognition/matching.js"></script>
    <script src="./src/recognition/preprocessing.js"></script>
    <script src="./src/recognition/nms.js"></script>

    <script>
        const resultsDiv = document.getElementById('results');
        const outputDiv = document.getElementById('output');

        function log(message, isError = false) {
            const color = isError ? '#f44336' : '#4caf50';
            outputDiv.innerHTML += `<span style="color: ${color}">${message}</span>\n`;
            console.log(message);
        }

        function clearOutput() {
            outputDiv.innerHTML = '';
        }

        function checkModule(name, obj) {
            const exists = typeof obj !== 'undefined';
            const mark = exists ? '‚úÖ' : '‚ùå';
            const className = exists ? 'pass' : 'fail';
            return `<div class="test-result ${className}">${mark} ${name}</div>`;
        }

        function displayResults() {
            const modules = [
                { name: 'CONFIG', obj: window.CONFIG },
                { name: 'Utils', obj: window.Utils },
                { name: 'HKIStorage', obj: window.HKIStorage },
                { name: 'CacheStorage', obj: window.CacheStorage },
                { name: 'CorrectionMemory', obj: window.CorrectionMemory },
                { name: 'ExportUtils', obj: window.ExportUtils },
                { name: 'Isolation', obj: window.Isolation },
                { name: 'Matching', obj: window.Matching },
                { name: 'Preprocessing', obj: window.Preprocessing },
                { name: 'NMS', obj: window.NMS }
            ];

            let html = '<div class="status">';
            html += '<h2>Module Load Status:</h2>';
            
            const loadedCount = modules.filter(m => typeof m.obj !== 'undefined').length;
            const totalCount = modules.length;
            
            modules.forEach(m => {
                html += checkModule(m.name, m.obj);
            });
            
            html += `<p><strong>Loaded: ${loadedCount} / ${totalCount}</strong></p>`;
            html += '</div>';
            
            resultsDiv.innerHTML = html;

            if (loadedCount === totalCount) {
                log('üéâ All modules loaded successfully!');
            } else {
                log(`‚ö†Ô∏è Only ${loadedCount}/${totalCount} modules loaded`, true);
            }
        }

        function runTests() {
            clearOutput();
            log('üß™ Running tests...\n');
            
            displayResults();
            
            // Test 1: Config
            if (typeof CONFIG !== 'undefined') {
                log(`‚úÖ CONFIG.APP_NAME = "${CONFIG.APP_NAME}"`);
                log(`‚úÖ CONFIG.APP_VERSION = "${CONFIG.APP_VERSION}"`);
            } else {
                log('‚ùå CONFIG not loaded', true);
            }
            
            // Test 2: Utils
            if (typeof Utils !== 'undefined') {
                const testDate = new Date('2025-11-26');
                log(`‚úÖ Utils.formatDate works: ${Utils.formatDate(testDate)}`);
            } else {
                log('‚ùå Utils not loaded', true);
            }
            
            // Test 3: HKI Storage
            if (typeof HKIStorage !== 'undefined') {
                const id = HKIStorage.generateInscriptionId();
                log(`‚úÖ HKIStorage.generateInscriptionId() = "${id}"`);
            } else {
                log('‚ùå HKIStorage not loaded', true);
            }
            
            // Test 4: Cache
            if (typeof CacheStorage !== 'undefined') {
                const available = CacheStorage.isStorageAvailable();
                log(`‚úÖ CacheStorage.isStorageAvailable() = ${available}`);
            } else {
                log('‚ùå CacheStorage not loaded', true);
            }
            
            log('\n‚úÖ Test suite complete!');
        }

        function testIdGeneration() {
            clearOutput();
            log('üî¢ Testing ID Generation...\n');
            
            if (typeof HKIStorage === 'undefined') {
                log('‚ùå HKIStorage not loaded!', true);
                return;
            }
            
            for (let i = 0; i < 5; i++) {
                const id = HKIStorage.generateInscriptionId();
                log(`‚úÖ ID ${i + 1}: ${id}`);
            }
            
            log('\n‚úÖ ID generation test complete!');
        }

        function testStorage() {
            clearOutput();
            log('üíæ Testing Storage...\n');
            
            if (typeof CacheStorage === 'undefined') {
                log('‚ùå CacheStorage not loaded!', true);
                return;
            }
            
            // Test save
            const testData = {
                test: 'data',
                timestamp: new Date().toISOString(),
                number: 42
            };
            
            log('Saving test data...');
            const saved = CacheStorage.saveToCache(testData, 'test_key');
            log(saved ? '‚úÖ Data saved successfully' : '‚ùå Failed to save', !saved);
            
            // Test load
            log('Loading test data...');
            const loaded = CacheStorage.loadFromCache('test_key');
            if (loaded && loaded.test === 'data') {
                log('‚úÖ Data loaded successfully');
                log(`   Data: ${JSON.stringify(loaded, null, 2)}`);
            } else {
                log('‚ùå Failed to load data', true);
            }
            
            // Test size
            const size = CacheStorage.getCacheSize();
            log(`\nüìä Cache Statistics:`);
            log(`   Total items: ${size.totalKeys}`);
            log(`   Total size: ${size.totalSizeKB} KB`);
            
            log('\n‚úÖ Storage test complete!');
        }

        // Auto-run on load
        window.addEventListener('load', () => {
            setTimeout(() => {
                displayResults();
                log('üöÄ Page loaded. Click "Run All Tests" to test modules.');
            }, 100);
        });
    </script>
</body>
</html>
